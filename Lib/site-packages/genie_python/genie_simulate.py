from __future__ import absolute_import
from __future__ import print_function
from builtins import object
from genie import _get_correct_globals
import genie_python.genie_simulate_impl as genie_sim


class Simulate(object):
    def __init__(self, populate_with_current_blocks=True):
        self.globs = _get_correct_globals()
        self.genie = self.globs['g']
        self.previous_api = self.genie._genie_api
        self.new_api = genie_sim.API(None, self.globs)
        if populate_with_current_blocks:
            dummy_values = ["INITIAL_VALUE"] * len(self.previous_api.get_block_names())
            self.new_api.set_multiple_blocks(self.previous_api.get_block_names(), dummy_values)

    def __enter__(self):
        self.genie._genie_api = self.new_api

    def __exit__(self, *args):
        self.genie._genie_api = self.previous_api
