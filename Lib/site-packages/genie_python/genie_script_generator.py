from abc import abstractmethod, ABCMeta
from typing import Union, AnyStr
import six
import sys
import functools
from builtins import object

@six.add_metaclass(ABCMeta)
class ActionDefinition(object):
    
    @abstractmethod
    def run(self, *args):
        """
        Defines the steps of an action which can be used in the script generator.

        Args:
            *args: The parameters of this action

        Returns:
            None

        """
        pass

    @abstractmethod
    def parameters_valid(self, *args):
        """
        Contains tests to check whether a given set of inputs is valid

        Args:
            *args: The parameters for this action

        Returns:
            None if all parameters are valid, otherwise a String containing an error message.

        """
        pass

    def get_file(self):
        return __file__

def cast_parameters_to(*args_casts, **keyword_casts):
    def decorator(func):
        @six.wraps(func)
        def wrapper(self, *args, **kwargs):
            casting_failures = ""
            cast_kwargs={}
            for k, v in six.iteritems(kwargs):
                try:
                    cast_kwargs[k] = keyword_casts[k](v)
                except ValueError:
                    casting_failures += "Cannot convert {} from string to {}\n".format(str(v), str(keyword_casts[k]))
            cast_args = []
            for i in range(len(args_casts)):
                try:
                    cast_args.append(args_casts[i](args[i]))
                except ValueError:
                    casting_failures += "Cannot convert {} from string to {}\n".format(args[i], str(args_casts[i]))
            if casting_failures != "":
                return casting_failures
            return func(self, *cast_args, **cast_kwargs)
        return wrapper
    return decorator

